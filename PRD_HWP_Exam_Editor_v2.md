# PRD: HWP 모의고사 자동 편집 프로그램

> **문서 버전**: v2.0 (최종)  
> **작성일**: 2026-02-15  
> **작성자**: 탄군 (한국경찰학원 디자인/홍보팀)  
> **개발 도구**: Claude Code (CLI)  
> **상태**: 최종 — 샘플 파일 분석 완료

---

## 1. 개요 (Overview)

### 1.1 문제 정의

한국경찰학원에서는 다수의 선생님으로부터 모의고사 HWP 파일을 받아, 학원 자체 양식의 **문제지**와 **정답+해설지**로 재편집하는 작업을 반복하고 있다. 선생님마다 파일 형식이 다르고, 40문제 이상의 파일을 과목별(경찰학, 형법, 형사소송법, 헌법, 행정법 등)로 처리하는 데 상당한 시간이 소요된다.

### 1.2 목표

선생님이 제공하는 원본 HWP 파일을 입력받아, 학원 지정 양식에 맞는 **문제지 HWP 1개**와 **정답+해설지 HWP 1개**를 자동으로 생성하는 **GUI 기반 데스크톱 프로그램**을 개발한다.

### 1.3 성공 지표

- 원본 HWP 1개 입력 → 문제지 + 해설지 2개 파일 자동 생성
- 해설이 없는 원본의 경우 → 문제지 1개만 생성
- 40문제 기준 처리 시간: **수작업 대비 80% 이상 단축**
- 학원 직원 누구나 사용 가능한 수준의 **간단한 GUI**

---

## 2. 사용자 (Users)

| 구분 | 설명 |
|------|------|
| **주 사용자** | 학원 직원 여러 명 (비개발자) |
| **사용 환경** | Windows PC + 한컴오피스 설치 환경 |
| **기술 수준** | 일반 사무 수준 (프로그래밍 경험 없음) |

### 2.1 사용자 요구사항

- 설치가 간단할 것 (.exe 실행 파일)
- 드래그앤드롭 또는 파일 선택 버튼으로 파일 입력
- 별도의 설정 없이 바로 변환 가능
- 오류 발생 시 이해하기 쉬운 한글 안내 메시지

---

## 3. 입력/출력 정의

### 3.1 입력 (Input)

| 항목 | 상세 |
|------|------|
| **파일 형식** | `.hwp` (한/글 HWP 바이너리 포맷) |
| **문제 수** | 40문제 이상 (과목별 20문제 단위도 있음) |
| **과목** | 경찰학, 형법, 형사소송법, 헌법, 행정법 등 여러 과목 혼합 |
| **콘텐츠 유형** | 텍스트 위주 + 가끔 표(테이블) 안에 텍스트 박스형 문제 |
| **처리 대상** | 4지선다형 객관식만 (O.X 주관식은 별도 프로그램으로 처리) |

#### 원본 파일 유형 (2가지)

| 유형 | 구조 | 출력 |
|------|------|------|
| **유형 A: 문제+해설 합본** | 1번문제→1번해설→2번문제→2번해설... | 문제지 + 해설지 (2개) |
| **유형 B: 순수 문제지** | 문제만 있고 해설 없음 | 문제지만 생성 (1개) |

→ 프로그램이 자동으로 유형을 감지하고, 유형 B의 경우 해설지 생성을 건너뛴다.

### 3.2 출력 (Output)

| 파일 | 내용 | 형식 |
|------|------|------|
| **문제지.hwp** | 문제 + 지문 + 보기만 추출, 학원 양식에 맞게 편집 | `.hwp` |
| **해설지.hwp** | 문제번호 + 정답 + 해설만 추출, 학원 양식에 맞게 편집 | `.hwp` |

### 3.3 학원 양식 규격 (문제지 & 해설지 공통)

문제지와 해설지 모두 동일한 양식을 사용한다.

#### 레이아웃

- **편집 방식**: 2단 편집 (좌우 컬럼)
- **헤더**: 프로그램에서 생성하지 않음. 직원이 모의고사마다 직접 수정함
- **프로그램 편집 범위**: 1번 문제부터 마지막 문제까지만 자동 편집
- **마지막 페이지 (QR코드 등)**: 프로그램에서 생성하지 않음. 직원이 직접 추가

#### 편집 용지 설정

| 항목 | 값 |
|------|-----|
| **용지 종류** | A4 (국배판) 210 × 297mm |
| **용지 방향** | 세로 |
| **제본** | 한쪽(1) |
| **위쪽 여백** | 15.0mm |
| **머리말** | 0.0mm |
| **왼쪽 여백** | 15.0mm |
| **오른쪽 여백** | 15.0mm |
| **제본** | 0.0mm |
| **꼬리말** | 5.0mm |
| **아래쪽 여백** | 10.0mm |

#### 글자 모양 (서식 규격)

| 항목 | 문제 제목 | 지문/보기/선택지 |
|------|----------|----------------|
| **폰트** | 중고딕 | 휴먼명조 |
| **글자 크기** | 9.5pt | 9.5pt |
| **상대 크기** | 100% | 100% |
| **장평** | 95% | 95% |
| **글자 위치** | 0% | 0% |
| **자간** | -5% | -5% |

#### 문단 모양

| 항목 | 값 |
|------|-----|
| **정렬 방식** | 양쪽 정렬 |
| **왼쪽 여백** | 0.0pt |
| **오른쪽 여백** | 0.0pt |
| **첫 줄** | 내어쓰기 13.8pt |
| **줄 간격** | 글자에 따라 140% |
| **문단 위** | 0.0pt |
| **문단 아래** | 0.0pt |
| **편집 용지의 줄 격자 사용** | ✅ 사용 |

#### 특수 서식 규칙

| 규칙 | 적용 대상 | 서식 |
|------|----------|------|
| **부정문 강조** | "옳지 않은", "틀린", "적절하지 않은", "올바르지 아니한" 등 | **굵게(Bold) + 밑줄(Underline)** |

---

## 4. 원본 파일 구조 분석 (실제 샘플 기반)

### 4.1 선생님별 원본 구조 비교

4개의 실제 샘플 파일을 분석한 결과:

| 파일 | 과목 | 유형 | 문제번호 형식 | 정답 형식 | 해설 형식 | 레이아웃 |
|------|------|------|-------------|----------|----------|---------|
| 형사소송법 (제6회) | 형소법 | **B (문제만)** | `1.` ~ `20.` | 없음 | 없음 | 2단 |
| 헌법 (6주차) | 헌법 | **A (합본)** | `1.` ~ `20.` | `정답 ④` | `해설 [×]` + `①:[○]` | 1단 |
| 형법 (6주차) | 형법 | **A (합본)** | `01.` ~ `20.` | `정답③` / `정답④` | 정답만 있거나 간략 | 1단 |
| 경찰학 (아침6회) | 경찰학/행정법 | **A (합본)** | `01.` ~ `20.` | `정답 : ②` | `해설 :` + `① (×)` | 1단 |

### 4.2 파싱 패턴 정의 (확정)

#### 문제 번호 시작 패턴

```regex
# 패턴 1: 한자리/두자리 숫자 + 점 (가장 일반적)
^\s*(\d{1,2})\s*[\.\)]\s*

# 패턴 2: 0 패딩 두자리 + 점
^\s*(0\d)\s*[\.\)]\s*

# 패턴 3: 【】 괄호형 (일부 선생님)
^\s*【\s*(\d{1,2})\s*】\s*

# 패턴 4: "문" 접두어
^\s*문\s*(\d{1,2})\s*[\.\)]\s*
```

#### 정답 감지 패턴 (4가지 변형 확인됨)

```regex
# 패턴 1: "정답 ④" (공백 + 원문자)
^\s*정답\s+[①②③④⑤]

# 패턴 2: "정답③" (공백 없이 붙여쓰기)
^\s*정답[①②③④⑤]

# 패턴 3: "정답 : ②" (콜론 포함)
^\s*정답\s*[:：]\s*[①②③④⑤]

# 패턴 4: "정답 : 2" (숫자형)
^\s*정답\s*[:：]\s*\d
```

#### 해설 감지 패턴

```regex
# 패턴 1: "해설 [×]" 또는 "해설 [○]"
^\s*해설\s*[\[【]?[×○xo]?[\]】]?

# 패턴 2: "해설 :" (콜론형)
^\s*해설\s*[:：]

# 패턴 3: 선택지별 해설 ("①:[○]", "② (×)" 등)
^\s*[①②③④⑤]\s*[:：]?\s*[\[\(]?[×○xo][\]\)]?

# 패턴 4: 관련 판례 인용
^\s*★\s*관련\s*판례
```

#### 보기/지문 감지 패턴

```regex
# 원문자 보기 블록
^\s*㉠|㉡|㉢|㉣|㉤|㉥

# 선택지
^\s*[①②③④⑤]\s*

# <보기> 또는 [보기] 마커
^\s*[<\[〈「]?\s*보기\s*[>\]〉」]?
```

#### 부정문 키워드 (굵게+밑줄 처리 대상)

```python
NEGATIVE_KEYWORDS = [
    "옳지 않은", "옳지않은",
    "틀린",
    "적절하지 않은", "적절하지않은",
    "올바르지 아니한", "올바르지아니한",
    "올바르지 않은", "올바르지않은",
    "가장 적절하지 않은",
    "가장 옳지 않은",
    "잘못된",
    "부적절한",
    "아닌 것",
    "않은 것",
]
```

### 4.3 유형 자동 감지 로직

```python
def detect_file_type(text_blocks):
    """
    원본 파일이 유형 A(문제+해설 합본)인지 유형 B(순수 문제지)인지 판별
    """
    answer_pattern = re.compile(r'^\s*정답\s*[:：]?\s*[①②③④⑤\d]')
    
    answer_count = sum(1 for block in text_blocks if answer_pattern.match(block))
    
    if answer_count >= 5:  # 정답 패턴이 5개 이상이면 합본으로 판단
        return "TYPE_A"  # 문제+해설 합본
    else:
        return "TYPE_B"  # 순수 문제지
```

### 4.4 문제 단위 파싱 흐름

```
원본 텍스트 스트림
       ↓
① 문제 번호 패턴 감지 → 새 문제 블록 시작
       ↓
② 텍스트 수집 (문제 본문 + 선택지)
       ↓
③ 정답 패턴 감지? 
   ├── YES → 정답 추출, 해설 수집 시작
   └── NO → 다음 문제 번호까지 계속 수집
       ↓
④ 다음 문제 번호 감지 → 현재 블록 종료, 새 블록 시작
       ↓
⑤ 반복... 마지막 문제까지
```

---

## 5. 데이터 모델

```python
from dataclasses import dataclass, field
from typing import Optional

@dataclass
class ExamQuestion:
    number: int                    # 문제 번호 (1, 2, 3...)
    question_text: str             # 문제 본문 (번호 제외)
    choices: list[str] = field(default_factory=list)      # 선택지 ["①...", "②...", ...]
    sub_items: list[str] = field(default_factory=list)     # 보기 항목 ["㉠...", "㉡...", ...]
    has_table: bool = False        # 표 포함 여부
    has_negative: bool = False     # 부정문 포함 여부
    negative_keyword: str = ""     # 감지된 부정문 키워드
    answer: Optional[str] = None   # 정답 ("③" 등, 없으면 None)
    explanation: Optional[str] = None  # 해설 본문 (없으면 None)

@dataclass
class ExamDocument:
    file_type: str                 # "TYPE_A" 또는 "TYPE_B"
    subject: str                   # 과목명
    questions: list[ExamQuestion] = field(default_factory=list)
    total_count: int = 0           # 총 문제 수

@dataclass 
class OutputConfig:
    output_directory: str          # 출력 폴더 경로
```

---

## 6. 기술 스택

| 역할 | 기술 | 선택 이유 |
|------|------|-----------|
| **언어** | Python 3.11+ | COM API 연동 용이, 빠른 프로토타이핑 |
| **HWP 제어** | `pywin32` (win32com) | 한/글 COM API로 읽기/쓰기 모두 가능 |
| **텍스트 파싱** | `re` (정규표현식) | 문제/해설 영역 패턴 매칭 |
| **GUI** | `PyQt5` | 드래그앤드롭, 미리보기, 모던 UI 지원 |
| **배포** | `PyInstaller` | 단일 .exe 배포, Python 미설치 환경에서 실행 가능 |
| **설정 관리** | `JSON` 파일 | 파싱 패턴, 템플릿 경로, 서식 설정 저장 |

### 6.1 필수 환경 조건

- **OS**: Windows 10/11
- **필수 설치**: 한컴오피스 (한/글) — COM API 호출을 위해 반드시 필요
- **필수 폰트**: 중고딕, 휴먼명조 (한컴오피스 설치 시 포함)
- **Python**: PyInstaller로 exe 변환 시 사용자 PC에 설치 불필요

---

## 7. 핵심 기능 상세

### 7.1 파일 입력 및 파싱

```
1. HWP 파일 열기 (COM API: hwp.Open)
2. 전체 텍스트 + 구조 정보 추출 (hwp.GetText, 표 객체 포함)
3. 파일 유형 자동 감지 (TYPE_A / TYPE_B)
4. 정규표현식으로 문제/정답/해설 블록 경계 감지
5. ExamQuestion 객체 리스트로 구조화
6. 부정문 키워드 감지 → has_negative 플래그 설정
```

### 7.2 문제지 생성

```
1. 새 HWP 문서 생성 (편집 용지 설정 적용)
2. 2단 편집 모드 설정
3. 각 문제를 순서대로 삽입:
   - 문제 번호 + 본문 (중고딕, 9.5pt)
   - 보기/지문 (휴먼명조, 9.5pt)
   - 선택지 (휴먼명조, 9.5pt)
   - 부정문 키워드 → Bold + Underline 적용
   - 문단 모양 적용 (내어쓰기 13.8pt, 줄간격 140%, 양쪽정렬)
4. 문제지.hwp 저장
※ 헤더(학원명, 날짜 등)와 마지막 페이지(QR코드 등)는 직원이 직접 추가
```

### 7.3 해설지 생성 (TYPE_A만 해당)

```
1. 새 HWP 문서 생성 (편집 용지 설정 적용)
2. 2단 편집 모드 설정
3. 각 문제의 정답+해설을 순서대로 삽입:
   - 문제 번호 + 정답 (예: "01. 정답 ③")
   - 해설 본문
   - 선택지별 O/X 해설 (있는 경우)
4. 서식 적용 (문제지와 동일)
5. 해설지.hwp 저장
※ 헤더는 직원이 직접 추가
```

### 7.4 서식 적용 함수 (COM API)

```python
def setup_page(hwp):
    """편집 용지 설정"""
    hwp.HAction.GetDefault("PageSetup", hwp.HParameterSet.HSecDef.HSet)
    sec = hwp.HParameterSet.HSecDef
    sec.PageDef.PaperType = hwp.PaperType("A4")
    sec.PageDef.Landscape = 0          # 세로
    sec.PageDef.TopMargin = hwp.MiliToHwpUnit(15.0)
    sec.PageDef.BottomMargin = hwp.MiliToHwpUnit(10.0)
    sec.PageDef.LeftMargin = hwp.MiliToHwpUnit(15.0)
    sec.PageDef.RightMargin = hwp.MiliToHwpUnit(15.0)
    sec.PageDef.HeaderLen = hwp.MiliToHwpUnit(0.0)
    sec.PageDef.FooterLen = hwp.MiliToHwpUnit(5.0)
    sec.PageDef.GutterType = 0         # 한쪽 제본
    hwp.HAction.Execute("PageSetup", hwp.HParameterSet.HSecDef.HSet)

def apply_question_format(hwp):
    """문제 제목 서식 적용 (중고딕)"""
    hwp.HAction.GetDefault("CharShape", hwp.HParameterSet.HCharShape.HSet)
    cs = hwp.HParameterSet.HCharShape
    cs.FaceNameHangul = "중고딕"
    cs.Height = hwp.PointToHwpUnit(9.5)
    cs.SpacingPercent = 95   # 장평
    cs.RatioPercent = -5     # 자간
    hwp.HAction.Execute("CharShape", hwp.HParameterSet.HCharShape.HSet)

def apply_passage_format(hwp):
    """지문/보기/선택지 서식 적용 (휴먼명조)"""
    hwp.HAction.GetDefault("CharShape", hwp.HParameterSet.HCharShape.HSet)
    cs = hwp.HParameterSet.HCharShape
    cs.FaceNameHangul = "휴먼명조"
    cs.Height = hwp.PointToHwpUnit(9.5)
    cs.SpacingPercent = 95
    cs.RatioPercent = -5
    hwp.HAction.Execute("CharShape", hwp.HParameterSet.HCharShape.HSet)

def apply_paragraph_format(hwp):
    """문단 모양 적용 (내어쓰기 13.8pt, 줄간격 140%)"""
    hwp.HAction.GetDefault("ParaShape", hwp.HParameterSet.HParaShape.HSet)
    ps = hwp.HParameterSet.HParaShape
    ps.AlignmentType = 2          # 양쪽 정렬
    ps.LeftMargin = 0
    ps.RightMargin = 0
    ps.IndentType = 2             # 내어쓰기
    ps.Indent = hwp.PointToHwpUnit(13.8)
    ps.LineSpacingType = 0        # 글자에 따라 (퍼센트)
    ps.LineSpacing = 140
    ps.SpaceBeforePara = 0
    ps.SpaceAfterPara = 0
    ps.UseGrid = 1                # 편집 용지의 줄 격자 사용
    hwp.HAction.Execute("ParaShape", hwp.HParameterSet.HParaShape.HSet)

def apply_bold_underline(hwp, text, keyword):
    """부정문 키워드에 굵게+밑줄 적용"""
    # 해당 키워드 범위 선택 후 Bold + Underline 적용
    pass
```

### 7.5 미리보기 및 수동 보정

```
기능: 자동 파싱 결과를 사용자에게 보여주고, 오류를 수정할 수 있게 함
UI 구성:
  - 왼쪽 패널: 감지된 문제 목록 (번호, 첫 줄 미리보기, 상태 아이콘)
    - ✅ 정상 감지
    - ⚠️ 해설 없음 (TYPE_B)
    - ❌ 파싱 실패
  - 오른쪽 패널: 선택한 문제의 상세 내용
    - 문제 영역 (파란색 하이라이트)
    - 정답 (빨간색)
    - 해설 영역 (초록색 하이라이트)
  - 수정 기능: 텍스트 직접 편집 가능
```

---

## 8. GUI 설계

### 8.1 메인 화면

```
┌──────────────────────────────────────────────────────┐
│  [로고] HWP 모의고사 편집기              [설정] [도움말] │
├──────────────────────────────────────────────────────┤
│                                                      │
│  📂 원본 파일                                         │
│  ┌──────────────────────────────────────────────┐    │
│  │                                              │    │
│  │     여기에 HWP 파일을 끌어다 놓으세요           │    │
│  │          또는 [파일 선택] 클릭                  │    │
│  │                                              │    │
│  └──────────────────────────────────────────────┘    │
│                                                      │
│  📊 파싱 결과                                         │
│  감지된 문제: 20개 | 유형: 문제+해설 합본               │
│  ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓ 100%                        │
│                                                      │
│  ※ 헤더(학원명, 날짜, 과목 등)는 생성하지 않습니다.      │
│    1번 문제부터 편집됩니다. 헤더는 직원이 직접 수정.      │
│                                                      │
│       [미리보기 확인]    [문제지 생성]    [해설지 생성]   │
└──────────────────────────────────────────────────────┘
```

### 8.2 미리보기 화면

```
┌──────────────────────────────────────────────────────┐
│  미리보기 — 파싱 결과 확인                      [닫기]  │
├───────────────────┬──────────────────────────────────┤
│  문제 목록         │  상세 내용                        │
│                   │                                  │
│  ✅ 01. 경찰청장에 │  [문제 영역]                      │
│  ✅ 02. 국가수사본 │  01. 경찰청장에 관한 설명으로      │
│  ✅ 03. 국가경찰위 │  옳지 **않은** 것을 모두 고르면?   │
│  ⚠️ 04. 시·도 자  │  ㉠ 경찰청장은 전시·사변...        │
│  ✅ 05. 경찰조직에 │  ① ㉠, ㉡  ② ㉢, ㉣             │
│  ...              │                                  │
│                   │  [정답] ③                         │
│                   │                                  │
│                   │  [해설 영역]                       │
│                   │  ㉡:[×] 퇴직일로부터 3년...        │
│                   │  ㉢:[×] 국립과학수사연구원은...     │
│                   │                                  │
├───────────────────┴──────────────────────────────────┤
│  감지: 20개 | 정상: 18개 | 경고: 2개                    │
│                [수정 완료]     [변환 진행]               │
└──────────────────────────────────────────────────────┘
```

### 8.3 설정 화면

```
┌──────────────────────────────────────────────────────┐
│  설정                                         [닫기]  │
├──────────────────────────────────────────────────────┤
│                                                      │
│  📁 출력 폴더                                         │
│  저장 위치:    [C:/모의고사_출력/]             [변경]    │
│                                                      │
│  🔤 서식 설정                                          │
│  문제 폰트:    [중고딕 ▼]     크기: [9.5 ▼]            │
│  지문 폰트:    [휴먼명조 ▼]   크기: [9.5 ▼]            │
│  줄 간격:      [140% ▼]      내어쓰기: [13.8pt ▼]     │
│  장평:         [95% ▼]       자간: [-5% ▼]            │
│                                                      │
│  📝 파싱 패턴 관리                                      │
│  문제 시작 패턴:  [4개 등록됨]                  [편집]   │
│  정답 감지 패턴:  [4개 등록됨]                  [편집]   │
│  해설 감지 패턴:  [4개 등록됨]                  [편집]   │
│  부정문 키워드:   [12개 등록됨]                 [편집]   │
│                                                      │
│                     [저장]      [취소]                  │
└──────────────────────────────────────────────────────┘
```

---

## 9. 개발 단계 (Phases)

### Phase 1: 코어 파싱 엔진 (MVP)

> **목표**: HWP 텍스트 추출 + 문제/해설 분리가 정확히 동작하는지 검증
> **기간**: 1~2주

- [ ] HWP COM API 연동 (파일 열기, 텍스트 추출)
- [ ] 파일 유형 자동 감지 (TYPE_A / TYPE_B)
- [ ] 정규표현식 기반 문제/정답/해설 블록 분리
- [ ] 표(테이블) 내 텍스트 추출
- [ ] 부정문 키워드 감지
- [ ] 콘솔 출력으로 파싱 결과 확인
- [ ] **4개 샘플 파일로 파싱 정확도 검증**

### Phase 2: 양식 기반 출력 생성

> **목표**: 파싱된 데이터를 학원 양식에 맞게 HWP로 출력
> **기간**: 1~2주

- [ ] 학원 양식 기반 새 HWP 문서 생성
- [ ] 헤더 영역 동적 생성 (날짜, 과목, 주차 등)
- [ ] 2단 편집 레이아웃 적용
- [ ] 문제 텍스트 삽입 + 서식 적용 (중고딕/휴먼명조, 9.5pt 등)
- [ ] 부정문 키워드 Bold+Underline 자동 적용
- [ ] 안내문 박스 + QR코드 영역 삽입
- [ ] 문제지.hwp / 해설지.hwp 저장

### Phase 3: GUI

> **목표**: 비개발자가 사용할 수 있는 인터페이스
> **기간**: 1~2주

- [ ] 메인 화면 (드래그앤드롭 파일 입력 + 시험 정보 입력)
- [ ] 미리보기 화면 (파싱 결과 확인 + 수동 보정)
- [ ] 설정 화면 (서식, 패턴, 경로 관리)
- [ ] 진행률 표시 + 한글 오류 메시지

### Phase 4: 안정화 및 배포

> **목표**: 학원 직원 누구나 설치/사용 가능
> **기간**: 1주

- [ ] PyInstaller로 .exe 패키징
- [ ] 다양한 선생님 양식으로 테스트 (최소 5개 이상)
- [ ] 파싱 패턴 추가/조정
- [ ] 간단한 사용 설명서 작성
- [ ] 학원 PC에 배포 및 실사용 테스트

---

## 10. 에러 처리

| 상황 | 처리 방법 | 사용자 메시지 |
|------|-----------|--------------|
| 한컴오피스 미설치 | 프로그램 시작 시 감지 후 안내 | "한컴오피스가 설치되어 있지 않습니다." |
| HWP 파일이 아닌 경우 | 확장자 검증 | "HWP 파일만 지원합니다." |
| 문제 번호 감지 실패 | 미리보기에서 경고 표시 | "⚠️ 자동 감지 실패 — 수동으로 확인해주세요." |
| 해설 없는 파일 (TYPE_B) | 자동 감지 후 안내 | "해설이 없는 파일입니다. 문제지만 생성됩니다." |
| 파일 암호화 | 안내 후 건너뛰기 | "파일이 암호로 보호되어 있습니다." |
| 필수 폰트 미설치 | 대체 폰트 사용 + 경고 | "중고딕 폰트가 없습니다. 대체 폰트를 사용합니다." |
| 시험 정보 미입력 | — | (해당 없음 — 헤더는 직원이 직접 수정) |

---

## 11. 프로젝트 구조

```
hwp-exam-editor/
├── main.py                      # 엔트리포인트
├── core/
│   ├── hwp_controller.py        # HWP COM API 래퍼
│   ├── parser.py                # 문제/해설 파싱 엔진
│   ├── detector.py              # 파일 유형 감지 + 부정문 감지
│   ├── generator.py             # 학원 양식 기반 HWP 출력 생성
│   ├── formatter.py             # 서식 적용 (폰트, 줄간격, Bold+Underline)
│   └── models.py                # 데이터 모델 (ExamQuestion, ExamDocument 등)
├── gui/
│   ├── main_window.py           # 메인 화면 (파일 입력 + 정보 입력)
│   ├── preview_window.py        # 미리보기 화면 (파싱 결과 + 수동 보정)
│   └── settings_window.py       # 설정 화면
├── config/
│   ├── default_config.json      # 기본 설정 (패턴, 서식, 경로)
│   ├── user_config.json         # 사용자 설정 (런타임 생성)
│   └── negative_keywords.json   # 부정문 키워드 목록
├── assets/
│   └── icon.ico                 # 프로그램 아이콘
├── tests/
│   ├── test_parser.py
│   ├── test_detector.py
│   ├── test_generator.py
│   └── sample_files/            # 4개 샘플 HWP (테스트용)
├── requirements.txt
├── README.md
└── build.spec                   # PyInstaller 빌드 설정
```

---

## 12. 설정 파일 구조 (default_config.json)

```json
{
  "format": {
    "question_font": "중고딕",
    "passage_font": "휴먼명조",
    "font_size": 9.5,
    "relative_size": 100,
    "char_width": 95,
    "char_spacing": -5,
    "char_position": 0,
    "columns": 2
  },
  "paragraph": {
    "alignment": "justify",
    "left_margin": 0.0,
    "right_margin": 0.0,
    "indent_type": "hanging",
    "indent_value": 13.8,
    "line_spacing_type": "percent_by_char",
    "line_spacing": 140,
    "space_before": 0.0,
    "space_after": 0.0,
    "use_grid": true
  },
  "page": {
    "paper_type": "A4",
    "orientation": "portrait",
    "binding": "left",
    "top_margin": 15.0,
    "bottom_margin": 10.0,
    "left_margin": 15.0,
    "right_margin": 15.0,
    "header_height": 0.0,
    "footer_height": 5.0,
    "gutter": 0.0
  },
  "parsing": {
    "question_patterns": [
      "^\\s*(\\d{1,2})\\s*[\\.\\)]\\s*",
      "^\\s*(0\\d)\\s*[\\.\\)]\\s*",
      "^\\s*【\\s*(\\d{1,2})\\s*】\\s*",
      "^\\s*문\\s*(\\d{1,2})\\s*[\\.\\)]\\s*"
    ],
    "answer_patterns": [
      "^\\s*정답\\s+[①②③④⑤]",
      "^\\s*정답[①②③④⑤]",
      "^\\s*정답\\s*[:：]\\s*[①②③④⑤]",
      "^\\s*정답\\s*[:：]\\s*\\d"
    ],
    "explanation_patterns": [
      "^\\s*해설\\s*[\\[【]?[×○xo]?[\\]】]?",
      "^\\s*해설\\s*[:：]",
      "^\\s*[①②③④⑤]\\s*[:：]?\\s*[\\[\\(]?[×○xo][\\]\\)]?"
    ],
    "type_a_threshold": 5
  },
  "negative_keywords": [
    "옳지 않은", "틀린", "적절하지 않은",
    "올바르지 아니한", "올바르지 않은",
    "가장 적절하지 않은", "가장 옳지 않은",
    "잘못된", "부적절한", "아닌 것", "않은 것"
  ],
  "paths": {
    "output_directory": ""
  }
}
```

---

## 13. 전체 처리 흐름 요약

```
사용자: HWP 파일 드래그앤드롭 + 시험 정보 입력
                    ↓
         ┌─────────────────┐
         │  1. HWP 파일 열기  │  (COM API)
         └────────┬────────┘
                  ↓
         ┌─────────────────┐
         │  2. 텍스트 추출    │  (GetText + 표 객체)
         └────────┬────────┘
                  ↓
         ┌─────────────────┐
         │  3. 유형 감지      │  TYPE_A or TYPE_B
         └────────┬────────┘
                  ↓
         ┌─────────────────┐
         │  4. 문제/해설 파싱  │  (정규표현식)
         └────────┬────────┘
                  ↓
         ┌─────────────────┐
         │  5. 미리보기 표시   │  → 사용자 확인/수정
         └────────┬────────┘
                  ↓
         ┌─────────────────┐
         │  6. 문제지 생성     │  학원 양식 + 서식 적용
         └────────┬────────┘
                  ↓
      ┌───── TYPE_A? ─────┐
      │ YES               │ NO
      ↓                   ↓
┌───────────┐      ┌──────────┐
│ 7. 해설지   │      │  완료     │
│    생성     │      │ (1개 출력) │
└─────┬─────┘      └──────────┘
      ↓
┌──────────┐
│  완료     │
│ (2개 출력) │
└──────────┘
```

---

## 14. 향후 확장 가능성

| 기능 | 설명 | 우선순위 |
|------|------|---------|
| O.X 주관식 자동 편집 | 별도 프로그램 또는 모듈 추가 | 중 |
| 과목 자동 감지 | 키워드 기반 과목명 추측 | 낮 |
| 배치 처리 | 여러 파일 한번에 변환 | 중 |
| 정답률 통계 | 문제별 정답 분포 분석 | 낮 |
| HWPX 지원 | XML 기반 파싱으로 COM API 의존도 감소 | 낮 |
| **HWP 스타일 기반 서식 적용** | 직접 속성 설정 → 스타일 방식으로 전환 | **높** |

---

## 15. 서식 적용 방식 개선 계획: HWP 스타일(Style) 전환

### 15.1 현재 방식의 문제점

현재 코드는 **HWP 스타일을 전혀 사용하지 않고**, 모든 서식을 직접 COM API로 적용하고 있다.

**현재 서식 적용 흐름:**

1. `core/formatter.py` — `HCharShape`, `HParaShape`로 일일이 속성 설정 (7개 언어별 폰트명, 장평, 자간 등을 개별 지정)
2. `core/hwp_patcher.py` — COM API로 폰트가 실제 DocInfo 테이블에 반영되지 않아, **HWP 바이너리 파일을 직접 수정**하는 후처리 수행
3. `SizeHangul` 값을 98/99로 마커로 사용하고, 나중에 바이너리에서 `face_id`를 교체하는 복잡한 우회 방식

**핵심 문제:**
- COM API의 `FaceNameHangul` 등으로 설정해도 실제 DocInfo의 폰트 테이블에 반영되지 않음
- 이를 해결하기 위해 바이너리 패칭(`hwp_patcher.py`, 약 240줄)이라는 불안정한 방법을 사용 중
- HWP 바이너리 구조(ZLIB 압축, DocInfo 레코드)에 의존하여 파일 포맷 변경 시 깨질 위험

### 15.2 개선 방안: HWP 스타일 기반 전환

한글의 **스타일(Style)** 기능을 활용하여 서식을 관리하면 위 문제들을 근본적으로 해결할 수 있다.

#### 현재 방식 vs 스타일 방식 비교

| 항목 | 현재 (직접 속성 지정) | 스타일 방식 |
|------|---------------------|------------|
| **폰트 적용** | COM API + 바이너리 패칭 | 스타일 적용 한 줄 |
| **코드 복잡도** | `formatter.py` + `hwp_patcher.py` ~240줄 | 스타일 정의 + 적용 |
| **안정성** | HWP 바이너리 구조에 의존 (깨질 수 있음) | 한글 내부에서 처리 |
| **유지보수** | 속성 하나 바꾸면 여러 곳 수정 필요 | 스타일 정의만 수정 |
| **폰트 매칭** | 불완전 (현재 문제 발생 중) | 한글이 자체적으로 처리 |

#### 정의할 스타일 목록

| 스타일명 | 용도 | 글자 모양 | 문단 모양 |
|---------|------|----------|----------|
| **문제** | 문제 번호 + 본문 | 중고딕, 9.5pt, 장평 95%, 자간 -5% | 양쪽정렬, 내어쓰기 13.8pt, 줄간격 140% |
| **지문** | 지문/보기/선택지 | 휴먼명조, 9.5pt, 장평 95%, 자간 -5% | 양쪽정렬, 내어쓰기 13.8pt, 줄간격 140% |
| **문제_강조** | 부정 키워드 부분 | 문제 스타일 + **Bold + Underline** | (문제 스타일 상속) |

#### 기대 효과

1. **`hwp_patcher.py` 완전 제거 가능** — 바이너리 패칭 불필요
2. **폰트 매칭 문제 해결** — 스타일은 한글의 1급 기능으로 폰트 테이블이 정상 반영됨
3. **코드 단순화** — `formatter.py`에서 7개 언어별 속성을 개별 설정하는 코드 제거
4. **설정 변경 용이** — 스타일 정의만 수정하면 전체 문서에 일괄 반영

### 15.3 구현 시 확인 사항

- HWP COM API에서 스타일 생성/수정/적용이 가능한지 API 조사 필요
- 스타일 적용 시 `CharShape`와 `ParaShape`가 모두 정상 반영되는지 검증
- 템플릿 HWP 파일에 스타일을 미리 정의해두고 열어서 사용하는 방식도 고려
